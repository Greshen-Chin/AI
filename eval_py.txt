
import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
from joblib import load

# ============================================================================
# LOAD MODEL & DATA
# ============================================================================

# Load trained model
model = load('models/demand_model.joblib')


X_test = np.random.randn(100, 8)  # dummy data 
y_test = np.abs(100 + 20 * np.random.randn(100))  # dummy data -

# ============================================================================
# PREDICT & CALCULATE METRICS
# ============================================================================

# Prediksi
y_pred = model.predict(X_test)

# Hitung metrik
mae = mean_absolute_error(y_test, y_pred)
rmse = np.sqrt(mean_squared_error(y_test, y_pred))
r2 = r2_score(y_test, y_pred)
mape = np.mean(np.abs((y_test - y_pred) / y_test)) * 100

# ============================================================================
# PRINT RESULTS
# ============================================================================

print("="*50)
print("HASIL EVALUASI MODEL")
print("="*50)
print(f"MAE  : {mae:.4f}")
print(f"RMSE : {rmse:.4f}")
print(f"R¬≤   : {r2:.4f}")
print(f"MAPE : {mape:.2f}%")
print("="*50)

# Interpretasi
if r2 > 0.9:
    print("‚úÖ Model EXCELLENT (R¬≤ > 0.9)")
elif r2 > 0.7:
    print("‚úÖ Model GOOD (R¬≤ > 0.7)")
else:
    print("‚ö†Ô∏è Model perlu improvement")

# ============================================================================
# VISUALISASI
# ============================================================================

fig, axes = plt.subplots(1, 2, figsize=(12, 4))

# Plot 1: Actual vs Predicted
axes[0].scatter(y_test, y_pred, alpha=0.6)
axes[0].plot([y_test.min(), y_test.max()], 
             [y_test.min(), y_test.max()], 'r--', lw=2)
axes[0].set_xlabel('Actual')
axes[0].set_ylabel('Predicted')
axes[0].set_title('Actual vs Predicted')
axes[0].grid(True, alpha=0.3)

# Plot 2: Residuals
residuals = y_test - y_pred
axes[1].scatter(y_pred, residuals, alpha=0.6)
axes[1].axhline(y=0, color='r', linestyle='--', lw=2)
axes[1].set_xlabel('Predicted')
axes[1].set_ylabel('Residuals')
axes[1].set_title('Residual Plot')
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('evaluation_results.png', dpi=300)
print("\n‚úÖ Plot saved: evaluation_results.png")
plt.show()

print("\nüéâ Evaluasi selesai!")